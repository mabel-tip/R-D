respectively, related primarily to our subsidiaries located outside of the U.S. Our income (loss) before provision for income taxes for the years ended
December 31, 2020, 2019 and 2018 was as follows (in millions):


**Year Ended December 31,**


**2020** **2019** **2018**
Domestic $ (198) $ (287) $ (412)
Noncontrolling interest and redeemable
noncontrolling interest 141 87 (87)
Foreign 1,211 (465) (506)
Income (loss) before income taxes $ 1,154 $ (665) $ (1,005)

The components of the provision for income taxes for the years ended December 31, 2020, 2019 and 2018 consisted of the following (in millions):

**Year Ended December 31,**
**2020** **2019** **2018**
Current:
Federal $ — $ — $ (1)
State 4 5 3
Foreign 248 86 24
Total current 252 91 26
Deferred:
Federal — (4) —
State — — —
Foreign 40 23 32
Total deferred 40 19 32
Total provision for income taxes $ 292 $ 110 $ 58

Deferred tax assets (liabilities) as of December 31, 2020 and 2019 consisted of the following (in millions):

**December 31,** **December 31,**
**2020** **2019**
**Deferred tax assets:**
Net operating loss carry-forwards $ 2,172 $ 1,846
Research and development credits 624 486
Other tax credits 168 126
Deferred revenue 450 301
Inventory and warranty reserves 315 243
Stock-based compensation 98 102
Operating lease right-of-use liabilities 335 290
Deferred GILTI tax assets 581 —
Accruals and others 205 16
Total deferred tax assets 4,948 3,410
Valuation allowance (2,930) (1,956)
Deferred tax assets, net of valuation allowance 2,018 1,454
**Deferred tax liabilities:**
Depreciation and amortization (1,488) (1,185)
Investment in certain financing funds (198) (17)
Operating lease right-of-use assets (305) (263)
Deferred revenue (50) —
Other (61) (24)
Total deferred tax liabilities (2,102) (1,489)
Deferred tax liabilities, net of valuation allowance
and deferred tax assets $ (84) $ (35)

96


-----


